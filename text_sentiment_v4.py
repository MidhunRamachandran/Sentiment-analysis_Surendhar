import re, json, codecs, csv
import nltk
import requests
from nltk.stem import PorterStemmer, SnowballStemmer, LancasterStemmer
from nltk.sentiment.vader import SentimentIntensityAnalyzer
sia = SentimentIntensityAnalyzer()
from nltk.stem.wordnet import WordNetLemmatizer
from textblob import TextBlob
import pandas as pd
from nltk.tokenize import RegexpTokenizer
import contractions

onfile = codecs.open("theme_consolidate.tsv", mode="w", encoding='utf-8')
onfile.write("UID\tProduct_ID\tReview_ID\tReview_Text\tProcessed_Text\tTokens\tRating\tTextBlob\tVader\tAPI\tMatched_token\tTheme\tSubtheme\n")

def polarity(value):
	try:
		value = float(value)
		if value >= 0.05:
			pole = "POSITIVE"
		elif value < 0.05 and value > -0.05:
			pole = "NEUTRAL"
		elif value <= 0.05:
			pole = "NEGATIVE"
		else:
			pole = str(value)
	except:
		pole = "n/a"
	return pole

# theme_text = {"price":["pay","affordable","almighty dollar","amount","appraisal","appraisement","asking price","bank note","banknote","bankroll","barter","bill","bottom dollar","bounty","buck","bucks","capital","cash","charge","cheap","check","coin","coinage","compensation","cost","currency","disbursement","discount","dues","economical","estimate","expenditure","expense","expensive","fare","fee","figure","finances","folding money","fund","funds","gold","greenback","hard cash","inexpensive","legal tender","loot","medium of exchange","money","note","outlay","output","pay","payment","pesos","premium","price","price tag","prize","property","quotation","ransom","rate","reckoning","resonable","resources","retail","return","reward","riches","salary","setback","silver","single","specie","tariff","ticket","toll","top dollar","treasure","valuation","value","wad","wage","wages","wealth","wherewithal","wholesale","worth"],"shipping_delivery":["assignment","arrive","assortment","bag","baggage","batch","bottle","box","bunch","can","cargo","carrier","carting","carton","consignment","container","conveyance","crate","delayed","delivered","delivery","dispatch","distribution","drop","freight","freighting","giving over","goods","handing over","haul","impartment","intrusting","kit","load","lot","luggage","mailing","pack","package","packet","parcel","parcel post","pile","portage","post","prompt","relegation","rendition","sack","sailing","schedule","scheduled","sending shipment","sheaf","ship","shipment","speedy","stack","suitcase","surrender","tin","tracking","transmission","transmittal","transport","trunk","unit"],"size":["admeasurement","amount","amplitude","area","bigness","body","breadth","broadness","bulk","caliber","capaciousness","capacity","closeness","compactness","concentration","content","density","diameter","dimension","dimensions","enormity","extension","extent","fatness","greatness","heaviness","height","highness","hugeness","immensity","intensity","largeness","length","magnitude","mass","measurement","module","number","proportion","proportions","range","scope","sizable","solidity","spread","stature","stretch","substance","substantiality","tonnage","total","vast","vastness","volume","voluminosity","width"],"quality":["abiding","bad","adapt","aspect","attribute","backbone","blot","break","broke","bumpy","check","condition","constancy","constant","crack","defective","deficiency","deformity","dependable","description","dirt","diuturnal","drawback","dumbest","durable","durableness","element","endowment","endurance","enduring","erratic","error","essence","excellence","factor","failing","fast","fault","faulty","firm","fixed","flaw","flexibility","foible","frailty","gap","genius","glitch","grade","gremlin","grit","guarantee","guard","guts","gutsiness","hard as nails","imperishability","impervious","indestructible","individuality","infirmity","injury","intestinal fortitude","irregularity","issues","kind","lack","lasting","lastingness","long-continued","maintenance","make","mark","marring","merit","misrepresent","mistake","moxie","nature","parameter","patch","peculiarity","perdurable","perduring","perfect","permanence","permanent","persistence","persistent","polish","potential","predication","predisposes","problem","property","protection","quality","rank","recommend","reliable","repair","replace","resistant","return","rift","rough spot","savor","scarcity","scratch","second","shortage","shortcoming","speck","spot","squeak","stable","stain","stamina","standard","staying power","stick-to-itiveness","strong","stupid","sturdy","substantial","supportive","taint","tough","trait","unsoundness","vice","want","weak point","weakness","worth"],"operational_effectiveness":["act","accessible","action","activity","adaptable","adjust","affair","agency","application","attractive","baking","bigger","bit","boiling","brewing","broiling","browning","capability","carrying on","challenging","clout","cogency","compatible","confuse","connecting","consume","control","convenient","conveyance","course","custom","deal","deed","design","differential","directions","doing","easily operated","easy to understand","effect","efficacy","efficiency","effort","employment","engagement","enterprise","exercise","exercising","exertion","exploitation","failed","failure","feasible","feature","fit","flawlessly","flexible","foolproof","force","forcefulness","frying","function","grilling","handiwork","handy","happening","heating","height","in service","in working order","induction","influence","instrumentality","integration","labor","manageable","manipulation","message","motion","movement","noise","operate","operating","operative","performance","play","point","potency","power","practicable","practical","prepared","procedure","proceeding","process","program","progress","progression","ready","reliable","response","roasting","scheduling","sear","service","serviceable","simmering","simple","simplicity","sizzle","sizzling","steaming","steeping","stewing","straightforward","strength","success","texture","toasting","transaction","transference","uncomplicated","undertaking","untroublesome","usable","use","useful","validity","validness","verve","viable","vigor","wieldy","work","workable","working","workmanship"],"maintenance":["purification","ablution","aliment","alimentation","alimony","antisepsis","brushing","care","clean","conservation","continuance","deodorizing","disinfection","dusting","keep","nurture","preservertion","prolongation","prophylaxis","purgation","purge","regular","repair","sanitation","scouring","scrubbing","shampooing","sterilization","subsistance","support","sustaining","sweeping","tidying","upkeep","washing"]}
# theme_text = {"price":['pay','affordable','almighty dollar','amount','appraisal','appraisement','asking price','bank note','banknote','bankroll','barter','bill','bottom dollar','bounty','buck','bucks','capital','cash','charge','cheap','coin','coinage','compensation','cost','currency','disbursement','discount','dues','economical','estimate','expenditure','expense','expensive','fare','fee','figure','finances','folding money','fund','funds','gold','greenback','hard cash','inexpensive','legal tender','loot','medium of exchange','money','note','outlay','output','payment','pesos','premium','price','price tag','prize','quotation','ransom','rate','reckoning','resonable','resources','retail','reward','riches','salary','setback','silver','single','specie','tariff','ticket','toll','top dollar','treasure','valuation','value','wad','wage','wages','wealth','wherewithal','wholesale'],"shipping_delivery":['assignment','arrive','assortment','bag','baggage','batch','bottle','box','bunch','can','cargo','carrier','carting','carton','consignment','container','conveyance','crate','delayed','delivered','delivery','dispatch','distribution','drop','freight','freighting','giving over','goods','handing over','haul','impartment','intrusting','kit','load','lot','luggage','mailing','pack','package','packet','parcel','parcel post','pile','portage','post','prompt','relegation','rendition','sack','sailing','schedule','scheduled','sending shipment','sheaf','ship','shipment','speedy','stack','suitcase','surrender','tin','tracking','transmission','transmittal','transport','trunk','unit','return'],"size":['admeasurement','amplitude','area','bigness','body','breadth','broadness','bulk','caliber','capaciousness','capacity','closeness','compactness','concentration','content','density','diameter','dimension','dimensions','enormity','extension','extent','fatness','greatness','heaviness','height','highness','hugeness','immensity','intensity','largeness','length','magnitude','mass','measurement','module','number','proportion','proportions','range','scope','sizable','solidity','spread','stature','stretch','substance','substantiality','tonnage','total','vast','vastness','volume','voluminosity','width'],"quality":['abiding','bad','adapt','aspect','attribute','backbone','blot','break','broke','bumpy','check','condition','constancy','constant','crack','defective','deficiency','deformity','dependable','description','dirt','diuturnal','drawback','dumbest','durable','durableness','element','endowment','endurance','enduring','erratic','error','essence','excellence','factor','failing','fast','fault','faulty','firm','fixed','flaw','flexibility','foible','frailty','gap','genius','glitch','grade','gremlin','grit','guarantee','guard','guts','gutsiness','hard as nails','imperishability','impervious','indestructible','individuality','infirmity','injury','intestinal fortitude','irregularity','issues','kind','lack','lasting','lastingness','long-continued','maintenance','make','mark','marring','merit','misrepresent','mistake','moxie','nature','parameter','patch','peculiarity','perdurable','perduring','perfect','permanence','permanent','persistence','persistent','polish','potential','predication','predisposes','problem','property','protection','quality','rank','recommend','reliable','replace','resistant','rift','rough spot','savor','scarcity','scratch','second','shortage','shortcoming','speck','spot','squeak','stable','stain','stamina','standard','staying power','stick-to-itiveness','strong','stupid','sturdy','substantial','supportive','taint','tough','trait','unsoundness','vice','want','weak point','weakness','worth'],"operational_effectiveness":['act','accessible','action','activity','adaptable','adjust','affair','agency','application','attractive','baking','bigger','bit','boiling','brewing','broiling','browning','capability','carrying on','challenging','clout','cogency','compatible','confuse','connecting','consume','control','convenient','course','custom','deal','deed','design','differential','directions','doing','easily operated','easy to understand','effect','efficacy','efficiency','effort','employment','engagement','enterprise','exercise','exercising','exertion','exploitation','failed','failure','feasible','feature','fit','flawlessly','flexible','foolproof','force','forcefulness','frying','function','grilling','handiwork','handy','happening','heating','in service','in working order','induction','influence','instrumentality','integration','labor','manageable','manipulation','message','motion','movement','noise','operate','operating','operative','performance','play','point','potency','power','practicable','practical','prepared','procedure','proceeding','process','program','progress','progression','ready','response','roasting','scheduling','sear','service','serviceable','simmering','simple','simplicity','sizzle','sizzling','steaming','steeping','stewing','straightforward','strength','success','texture','toasting','transaction','transference','uncomplicated','undertaking','untroublesome','usable','use','useful','validity','validness','verve','viable','vigor','wieldy','work','workable','working','workmanship'],"maintenance":['purification','ablution','aliment','alimentation','alimony','antisepsis','brushing','care','clean','conservation','continuance','deodorizing','disinfection','dusting','keep','nurture','preservertion','prolongation','prophylaxis','purgation','purge','regular','repair','sanitation','scouring','scrubbing','shampooing','sterilization','subsistance','support','sustaining','sweeping','tidying','upkeep','washing']}
theme_text = {"price":['affordable','almighty dollar','appraisal','appraisement','asking price','bank note','banknote','bankroll','barter','bill','bottom dollar','bounty','buck','bucks','capital','cash','charge','coin','coinage','compensation','cost','currency','disbursement','discount','dues','economical','estimate','expenditure','expense','expensive','fare','fee','figure','finances','folding money','fund','funds','gold','greenback','hard cash','inexpensive','legal tender','loot','medium of exchange','money','note','outlay','output','pay','payment','pesos','premium','price','price tag','prize','quotation','ransom','rate','reckoning','resonable','resources','retail','reward','riches','salary','setback','silver','single','specie','tariff','ticket','toll','top dollar','treasure','valuation','value','wad','wage','wages','wealth','wherewithal','wholesale'],"shipping_delivery":['arrive','assignment','assortment','bag','baggage','batch','bottle','box','bunch','can','cargo','carrier','carting','carton','consignment','container','crate','delayed','delivered','delivery','dispatch','distribution','drop','freight','freighting','giving over','goods','handing over','haul','impartment','intrusting','kit','load','lot','luggage','mailing','pack','package','packet','parcel','parcel post','pile','portage','post','prompt','relegation','rendition','sack','sailing','schedule','scheduled','sending shipment','sheaf','ship','shipment','speedy','stack','suitcase','surrender','tin','tracking','transmission','transmittal','transport','trunk','unit'],"size":['admeasurement','amount','amplitude','area','bigness','body','breadth','broadness','bulk','caliber','capaciousness','capacity','chhota','closeness','cm','compactness','concentration','content','deceptive','density','diameter','dimension','dimensions','enormity','extension','extent','fatness','greatness','heaviness','height','highness','hugeness','immensity','intensity','largeness','length','magnitude','mass','measurement','medium','ml','module','number','proportion','proportions','quantity','range','scope','sizable','size','small','smaller','solidity','spread','stature','stretch','substance','substantiality','tonnage','too small','total','vast','vastness','volume','voluminosity','width'],"quality":['abiding','adapt','amaze','aspect','attribute','average','awesome','awful','backbone','bad','bakwas','beautiful','best','blot','break','broke','bumpy','burst','cheap','cheat','check','class','coating','compromise','condition','constancy','constant','crack','cute','damage','deep','defect','defective','deficiency','deformity','dent','dependable','description','deterioated','dirt','disappoint','diuturnal','drawback','dumbest','durable','durableness','element','endowment','endurance','enduring','erratic','error','essence','excellence','excellent','expect','expectation','factor','failing','fake','fast','fault','faulty','firm','fixed','flaw','flexibility','foible','frailty','fresh','gap','genius','glitch','good','grade','great','gremlin','grit','guarantee','guard','guts','gutsiness','hard as nails','heavy','horrible','imperishability','impervious','impressive','indestructible','individuality','infirmity','injury','inside','intestinal fortitude','irregularity','issues','kind','lack','lasting','lastingness','lickage','light','like','long-continued','loose','love','lovely','maintenance','make','mark','marring','merit','misrepresent','mistake','moxie','nature','neat','nice','notgood','ok','okay','old','parameter','patch','pathetic','peculiarity','peelingoff','perdurable','perduring','perfect','permanence','permanent','persistence','persistent','plastic','polish','poor','potential','predication','predisposes','problem','proper','property','protection','quality','rank','recommend','refurbish','reliable','repair','replace','resistant','return','rift','rough spot','rubbish','satisfied','savor','scarcity','scratch','second','shortage','shortcoming','speck','spot','squeak','stable','stain','stamina','stand','standard','staying power','stick','stick-to-itiveness','strong','stupid','sturdy','substantial','super','supportive','taint','teflon','terrible','thick','thin','tough','trait','unhealthy','unsoundness','useless','vice','want','weak point','weakness','weight','wonder','wood','worst','worth','worthy'],"operational_effectiveness":['accessible','act','action','activity','adaptable','adjust','affair','agency','application','apply','attractive','baking','basic','bigger','bit','boiling','brewing','broiling','browning','burning','capability','carrying on','challenging','chop','clout','cogency','comfortable','compatible','confuse','connecting','consume','control','convenient','conveyance','cook','course','custom','cut','deal','deed','design','differential','directions','doing','easily operated','easy to understand','effect','efficacy','efficiency','effort','employment','engagement','enterprise','exercise','exercising','exertion','exploitation','failed','failure','feasible','feature','fit','flawlessly','flexible','foolproof','force','forcefulness','friendly','frying','function','grilling','handiwork','handle','handy','happening','heating','in service','in working order','induction','influence','instrumentality','integration','labor','manageable','manipulation','message','motion','movement','noise','non-stick','operate','operating','operative','peeling','performance','play','point','potency','power','practicable','practical','prepared','procedure','proceeding','process','program','progress','progression','ready','response','result','roasting','scheduling','seamless','sear','serves','service','serviceable','sharp','simmering','simple','simplicity','sizzle','sizzling','steaming','steeping','stewing','straightforward','strength','success','texture','toasting','transaction','transference','uncomplicated','undertaking','uniform','untroublesome','usable','use','useful','validity','validness','verve','viable','vigor','wieldy','work','workable','working','workmanship'],"maintenance":['ablution','aliment','alimentation','alimony','antisepsis','brushing','care','change','clean','conservation','continuance','deodorizing','disinfection','dusting','keep','nurture','preservertion','prolongation','prophylaxis','purgation','purge','purification','regular','replacement','restock','sanitation','scouring','scrubbing','shampooing','sterilization','subsistance','support','sustaining','sweeping','tidying','upkeep','washing']}
mentions_text = [{"token":"value for money","theme":"price","subtheme":"affordable price"},{"token":"very cheap","theme":"price","subtheme":"cheaper price"},{"token":"very expensive","theme":"price","subtheme":"expensive"},{"token":"bang for buck","theme":"price","subtheme":"affordable price"},{"token":"good price","theme":"price","subtheme":"affordable price"},{"token":"affordable price","theme":"price","subtheme":"affordable price"},{"token":"affordable cost","theme":"price","subtheme":"affordable price"},{"token":"affordable product","theme":"price","subtheme":"affordable price"},{"token":"affordable pan","theme":"price","subtheme":"affordable price"},{"token":"affordable kadai","theme":"price","subtheme":"affordable price"},{"token":"cheap pan","theme":"price","subtheme":"cheaper price"},{"token":"cheap kadai","theme":"price","subtheme":"cheaper price"},{"token":"over priced","theme":"price","subtheme":"expensive"},{"token":"very pricey","theme":"price","subtheme":"expensive"},{"token":"pricey product","theme":"price","subtheme":"expensive"},{"token":"premium price","theme":"price","subtheme":"expensive"},{"token":"worth\u00a0the\u00a0money","theme":"price","subtheme":"affordable price"},{"token":"worth\u00a0the price","theme":"price","subtheme":"affordable price"},{"token":"price is high","theme":"price","subtheme":"expensive"},{"token":"worth every penny","theme":"price","subtheme":"affordable price"},{"token":"price not justifying","theme":"price","subtheme":"expensive"},{"token":"overpriced","theme":"price","subtheme":"expensive"},{"token":"expensive but worth","theme":"price","subtheme":"expensive"},{"token":"little costly","theme":"price","subtheme":"expensive"},{"token":"good investment","theme":"price","subtheme":"affordable price"},{"token":"price little costly","theme":"price","subtheme":"expensive"},{"token":"very costly","theme":"price","subtheme":"expensive"},{"token":"best price","theme":"price","subtheme":"affordable price"},{"token":"not worth","theme":"price","subtheme":"expensive"},{"token":"money well spent","theme":"price","subtheme":"affordable price"},{"token":"slightly expensive","theme":"price","subtheme":"expensive"},{"token":"cheaper price","theme":"price","subtheme":"cheaper price"},{"token":"waste of money","theme":"price","subtheme":"expensive"},{"token":"high margin cost","theme":"price","subtheme":"expensive"},{"token":"bit cheaper","theme":"price","subtheme":"cheaper price"},{"token":"worst price","theme":"price","subtheme":"expensive"},{"token":"decent price","theme":"price","subtheme":"affordable price"},{"token":"costly product","theme":"price","subtheme":"expensive"},{"token":"dissatisfied with price","theme":"price","subtheme":"expensive"},{"token":"price is low","theme":"price","subtheme":"cheaper price"},{"token":"standard price","theme":"price","subtheme":"affordable price"},{"token":"a bit costly","theme":"price","subtheme":"expensive"},{"token":"worth for price","theme":"price","subtheme":"affordable price"},{"token":"genuine price","theme":"price","subtheme":"affordable price"},{"token":"very high price","theme":"price","subtheme":"expensive"},{"token":"satisfied with price","theme":"price","subtheme":"affordable price"},{"token":"little bit cheaper","theme":"price","subtheme":"cheaper price"},{"token":"slightly inexpensive","theme":"price","subtheme":"cheaper price"},{"token":"broken handle","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"broken part","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"bad handles","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"fully scratches\u00a0","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"coating came out","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"plastic knob\u00a0broken","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"wooden had crack","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"tremendous delivery","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"well packed","theme":"shipping_delivery","subtheme":"good packing"},{"token":"arrived on time","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"worst package","theme":"shipping_delivery","subtheme":"poor packing"},{"token":"inappropriate description","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"dispatching broken products","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"picture are incorrect","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"false information","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"product\u00a0are incorrect","theme":"shipping_delivery","subtheme":"wrong material"},{"token":"package was amazing","theme":"shipping_delivery","subtheme":"good packing"},{"token":"no\u00a0guarantee card","theme":"shipping_delivery","subtheme":"additional details missing"},{"token":"no\u00a0scrubber provided","theme":"shipping_delivery","subtheme":"additional materials needed"},{"token":"incorrect product description","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"wrong description","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"supplied broken lid","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"replaced after request","theme":"shipping_delivery","subtheme":"good replacement"},{"token":"received with scratches","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"good as expected","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"very bad service","theme":"shipping_delivery","subtheme":"poor delivery service"},{"token":"poor service","theme":"shipping_delivery","subtheme":"poor delivery service"},{"token":"excellent service","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"package not good","theme":"shipping_delivery","subtheme":"poor packing"},{"token":"no damage found","theme":"shipping_delivery","subtheme":"good packing"},{"token":"need replacement","theme":"shipping_delivery","subtheme":"need replacement"},{"token":"perfect replacement","theme":"shipping_delivery","subtheme":"good replacement"},{"token":"nicely packed product","theme":"shipping_delivery","subtheme":"good packing"},{"token":"better than expectations","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"received without lid","theme":"shipping_delivery","subtheme":"additional materials needed"},{"token":"quick delivery","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"well packaged","theme":"shipping_delivery","subtheme":"good packing"},{"token":"disappointed with delivery","theme":"shipping_delivery","subtheme":"poor delivery service"},{"token":"got damaged product","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"received defective lid","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"received damage product","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"good delivery service","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"bad delivery service","theme":"shipping_delivery","subtheme":"poor delivery service"},{"token":"received broken handle","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"prompt delivery","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"received defect item","theme":"shipping_delivery","subtheme":"damaged product"},{"token":"delivered before expected","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"box already opened","theme":"shipping_delivery","subtheme":"poor packing"},{"token":"no warranty card","theme":"shipping_delivery","subtheme":"additional details missing"},{"token":"requested to refund","theme":"shipping_delivery","subtheme":"refund"},{"token":"shipped on time\u00a0","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"early delivery","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"late delivery","theme":"shipping_delivery","subtheme":"poor delivery service"},{"token":"exchange policy","theme":"shipping_delivery","subtheme":"additional details missing"},{"token":"received used product","theme":"shipping_delivery","subtheme":"need replacement"},{"token":"box was torned","theme":"shipping_delivery","subtheme":"poor packing"},{"token":"delivered used product","theme":"shipping_delivery","subtheme":"need replacement"},{"token":"want to return","theme":"shipping_delivery","subtheme":"need replacement"},{"token":"poor replacement","theme":"shipping_delivery","subtheme":"poor replacement"},{"token":"duplicate product\u00a0image","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"satisfied with delivery","theme":"shipping_delivery","subtheme":"good delivery service"},{"token":"false product\u00a0description","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"wrong mrp information","theme":"shipping_delivery","subtheme":"wrong product details"},{"token":"big in size","theme":"size","subtheme":"bigger size"},{"token":"its compact","theme":"size","subtheme":"correct size"},{"token":"strong and heavy","theme":"size","subtheme":"insignificant"},{"token":"perfect size\u00a0","theme":"size","subtheme":"correct size"},{"token":"heavy weight","theme":"size","subtheme":"insignificant"},{"token":"light weight","theme":"size","subtheme":"insignificant"},{"token":"thick body","theme":"size","subtheme":"correct size"},{"token":"quite big","theme":"size","subtheme":"bigger size"},{"token":"little smaller","theme":"size","subtheme":"insignificant"},{"token":"standard size","theme":"size","subtheme":"correct size"},{"token":"comfortable","theme":"size","subtheme":"correct size"},{"token":"very convenient","theme":"size","subtheme":"correct size"},{"token":"good shape","theme":"size","subtheme":"good design"},{"token":"great finesse","theme":"size","subtheme":"good finish"},{"token":"long handle","theme":"size","subtheme":"insignificant"},{"token":"not perfect fit","theme":"size","subtheme":"insignificant"},{"token":"nice finish","theme":"size","subtheme":"good finish"},{"token":"classy look","theme":"size","subtheme":"good design"},{"token":"slightly flat bottom","theme":"size","subtheme":"poor design"},{"token":"fantastic design","theme":"size","subtheme":"good design"},{"token":"shape is round","theme":"size","subtheme":"good design"},{"token":"small in size","theme":"size","subtheme":"insignificant"},{"token":"very small size","theme":"size","subtheme":"insignificant"},{"token":"poor design","theme":"size","subtheme":"poor design"},{"token":"good finish","theme":"size","subtheme":"good finish"},{"token":"not proper round","theme":"size","subtheme":"poor design"},{"token":"no proper size","theme":"size","subtheme":"poor design"},{"token":"no proper shape","theme":"size","subtheme":"poor design"},{"token":"nice look","theme":"size","subtheme":"good looking"},{"token":"heavy glass lid","theme":"size","subtheme":"insignificant"},{"token":"good bottom curvature","theme":"size","subtheme":"good design"},{"token":"looks classy","theme":"size","subtheme":"good looking"},{"token":"design is conventional","theme":"size","subtheme":"good design"},{"token":"unique design","theme":"size","subtheme":"good design"},{"token":"bit higher size","theme":"size","subtheme":"bigger size"},{"token":"bigger in size","theme":"size","subtheme":"bigger size"},{"token":"compatible","theme":"size","subtheme":"good design"},{"token":"little small","theme":"size","subtheme":"insignificant"},{"token":"diameter is huge","theme":"size","subtheme":"bigger size"},{"token":"lid is heavy","theme":"size","subtheme":"insignificant"},{"token":"very well constructed","theme":"size","subtheme":"good design"},{"token":"small than expected","theme":"size","subtheme":"insignificant"},{"token":"dimensions are large","theme":"size","subtheme":"bigger size"},{"token":"quite good size\u00a0","theme":"size","subtheme":"good design"},{"token":"dimensions are small","theme":"size","subtheme":"poor design"},{"token":"small to use","theme":"size","subtheme":"insignificant"},{"token":"very big enough","theme":"size","subtheme":"bigger size"},{"token":"smooth finish","theme":"size","subtheme":"good finish"},{"token":"meticulously designed","theme":"size","subtheme":"good design"},{"token":"size is sufficient","theme":"size","subtheme":"good design"},{"token":"bigger than expected","theme":"size","subtheme":"bigger size"},{"token":"weighs little heavy","theme":"size","subtheme":"insignificant"},{"token":"designed it superbly","theme":"size","subtheme":"good design"},{"token":"little less diameter","theme":"size","subtheme":"insignificant"},{"token":"looks beautiful","theme":"size","subtheme":"good design"},{"token":"awesome product","theme":"quality","subtheme":"superior quality"},{"token":"bad quality","theme":"quality","subtheme":"poor quality"},{"token":"good quality","theme":"quality","subtheme":"superior quality"},{"token":"highly satisfied quality","theme":"quality","subtheme":"superior quality"},{"token":"good product","theme":"quality","subtheme":"superior quality"},{"token":"excellent product","theme":"quality","subtheme":"superior quality"},{"token":"best nonstick pan","theme":"quality","subtheme":"superior quality"},{"token":"strong quality","theme":"quality","subtheme":"superior quality"},{"token":"cheap quality","theme":"quality","subtheme":"poor quality"},{"token":"build quality excellent","theme":"quality","subtheme":"superior quality"},{"token":"highly recommended","theme":"quality","subtheme":"superior quality"},{"token":"low quality","theme":"quality","subtheme":"poor quality"},{"token":"perfect for cooking","theme":"quality","subtheme":"superior quality"},{"token":"thick coating","theme":"quality","subtheme":"superior quality"},{"token":"extremely happy","theme":"quality","subtheme":"superior quality"},{"token":"lid quality good","theme":"quality","subtheme":"superior quality"},{"token":"pan quality good","theme":"quality","subtheme":"superior quality"},{"token":"very smooth","theme":"quality","subtheme":"superior quality"},{"token":"non-stick coating","theme":"quality","subtheme":"superior quality"},{"token":"damage on coating","theme":"quality","subtheme":"poor quality"},{"token":"poor quality","theme":"quality","subtheme":"poor quality"},{"token":"cheap product","theme":"quality","subtheme":"poor quality"},{"token":"cheap materials used","theme":"quality","subtheme":"poor quality"},{"token":"not good quality","theme":"quality","subtheme":"poor quality"},{"token":"pathetic quality","theme":"quality","subtheme":"poor quality"},{"token":"quality so worst","theme":"quality","subtheme":"poor quality"},{"token":"Dissatisfactory product","theme":"quality","subtheme":"poor quality"},{"token":"quality not good","theme":"quality","subtheme":"poor quality"},{"token":"good wooden handles","theme":"quality","subtheme":"superior quality"},{"token":"hard anodised material","theme":"quality","subtheme":"superior quality"},{"token":"satisfied with quality","theme":"quality","subtheme":"superior quality"},{"token":"great build quality","theme":"quality","subtheme":"superior quality"},{"token":"not pure nonstick","theme":"quality","subtheme":"poor quality"},{"token":"cheap nonstick pan","theme":"quality","subtheme":"poor quality"},{"token":"ultra high strength","theme":"quality","subtheme":"superior quality"},{"token":"top notch quality","theme":"quality","subtheme":"superior quality"},{"token":"impressive quality","theme":"quality","subtheme":"superior quality"},{"token":"worst handle quality","theme":"quality","subtheme":"poor quality"},{"token":"low\u00a0quality\u00a0paint","theme":"quality","subtheme":"poor quality"},{"token":"genuine product","theme":"quality","subtheme":"superior quality"},{"token":"absolutely fine material","theme":"quality","subtheme":"superior quality"},{"token":"unpolished handle","theme":"quality","subtheme":"poor quality"},{"token":"superior quality","theme":"quality","subtheme":"superior quality"},{"token":"great buy","theme":"quality","subtheme":"superior quality"},{"token":"sturdy handles","theme":"quality","subtheme":"superior quality"},{"token":"layer peeled off","theme":"quality","subtheme":"poor quality"},{"token":"coating gone","theme":"quality","subtheme":"poor quality"},{"token":"sturdy material","theme":"quality","subtheme":"superior quality"},{"token":"very strong kadhai","theme":"quality","subtheme":"superior quality"},{"token":"handles are strong","theme":"quality","subtheme":"superior quality"},{"token":"screws gone away\u00a0","theme":"quality","subtheme":"poor quality"},{"token":"completely scratched up","theme":"quality","subtheme":"poor quality"},{"token":"looks sturdy","theme":"quality","subtheme":"superior quality"},{"token":"coating came off","theme":"quality","subtheme":"poor quality"},{"token":"thickness is good","theme":"quality","subtheme":"superior quality"},{"token":"thick gauge","theme":"quality","subtheme":"superior quality"},{"token":"very effective coating","theme":"quality","subtheme":"superior quality"},{"token":"good thickness","theme":"quality","subtheme":"superior quality"},{"token":"no scratches","theme":"quality","subtheme":"superior quality"},{"token":"hard non stick","theme":"quality","subtheme":"superior quality"},{"token":"more durable","theme":"quality","subtheme":"superior quality"},{"token":"thick base","theme":"quality","subtheme":"superior quality"},{"token":"good inner coating\u00a0","theme":"quality","subtheme":"superior quality"},{"token":"easy to grab","theme":"operational_effectiveness","subtheme":"easy to use"},{"token":"good to hold","theme":"operational_effectiveness","subtheme":"easy to use"},{"token":"heat resistant","theme":"operational_effectiveness","subtheme":"heat resistant"},{"token":"easier to cook","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"multipurpose utility","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"easy to hold","theme":"operational_effectiveness","subtheme":"easy to use"},{"token":"stable while cooking","theme":"operational_effectiveness","subtheme":"easy to use"},{"token":"very useful","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"food sticks easily","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"sufficient to cook","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"firm handle","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"pan heats quicker","theme":"operational_effectiveness","subtheme":"adaptable product"},{"token":"heavy weight pan","theme":"operational_effectiveness","subtheme":"very heavy"},{"token":"retains heat well","theme":"operational_effectiveness","subtheme":"heat resistant"},{"token":"very sticky\u00a0","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"stability issue","theme":"operational_effectiveness","subtheme":"imbalance"},{"token":"easily slipped off","theme":"operational_effectiveness","subtheme":"imbalance"},{"token":"to much sticky","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"food sticks frequently","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"stick very easily","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"sticks to bottom","theme":"operational_effectiveness","subtheme":"very sticky"},{"token":"easy\u00a0to\u00a0clean\u00a0","theme":"maintenance","subtheme":"easy to clean"},{"token":"low maintenance","theme":"maintenance","subtheme":"low maintenance"},{"token":"easy to maintain","theme":"maintenance","subtheme":"low maintenance"},{"token":"less maintenance","theme":"maintenance","subtheme":"low maintenance"},{"token":"difficult to wash\u00a0","theme":"maintenance","subtheme":"difficult to wash"},{"token":"impossible to maintain","theme":"maintenance","subtheme":"difficult to wash"},{"token":"impossible to clean","theme":"maintenance","subtheme":"difficult to wash"},{"token":"difficult to clean","theme":"maintenance","subtheme":"difficult to wash"},{"token":"easy to manage","theme":"maintenance","subtheme":"low maintenance"},{"token":"tough to Clean","theme":"maintenance","subtheme":"difficult to wash"},{"token":"maintainance is low","theme":"maintenance","subtheme":"low maintenance"},{"token":"easy to wash","theme":"maintenance","subtheme":"easy to clean"}]

##stemming
lem = WordNetLemmatizer()
theme_stem = {}
for x in theme_text:
	q = []
	for y in theme_text[x]:
		y = lem.lemmatize(y.strip(), pos="v")
		if y not in q:
			q.append(y)
		theme_stem[x] = q

df = pd.read_excel("Bigbasket Review.xlsx", encoding='utf-8', keep_default_na=False, na_values=[''], index=False)
df = df.fillna('')
counter = 0
json_data = json.loads(df.to_json(orient='index'))
for sku in json_data:
	review_id = str(json_data[sku]['UID'])
	product_id = str(json_data[sku]['Product_ID']).strip()
	review_title = str(json_data[sku]['Review_Title']).strip()
	review_text = str(json_data[sku]['Review_Text'])
	rating = str(json_data[sku]['Rating'])
	if review_title == 'n/a':
		review_title = ''
	if review_text == 'n/a':
		review_text = ''
	review_text = review_title + " " + review_text
	if review_text.strip():
		##lower case
		words = review_text.lower().strip()

		##cleaning
		words = re.sub(r'[^A-Za-z0–9\'\`]+', ' ', words)
		words = re.sub(r'\t+|\r+|\s+|\n+', ' ', words.strip())
		words = re.sub(r'\s+', ' ', words.strip())

		##tokenize
		tokens = nltk.word_tokenize(contractions.fix(words.strip()))
		# tokenizer = RegexpTokenizer(r'\w+')
		# tokens = tokenizer.tokenize(words)

		##stopwords removal
		##'can','will','do','did','could','would','has','have','had',
		stopwords = ['n/a','so','i','me','my','myself','we','our','ours','ourselves','you',"you're","you've","you'll","you'd",'your','youre',"youve","youll",'youd','yours','yourself','yourselves','he','him','his','himself','she',"she's",'her ','shes','hers','herself','it',"it's",'its','itself','they','them','their','theirs','themselves','what','which','who','whom','this','that',"that'll",'these ','thatll','those','am','is','are','was','were','be','been','being','doing','a','an','the','and','if','or','because','as','until','while','of','at','by','for','with','about','between','into','through','during','before','after','to','from','in','out','on','off','then','once','here','there','when','where','why','how','all','any','both','each','will','ain','ma','shan',"shan't",'shan ','shant']
		# stopwords = [re.sub(r'[^A-Za-z0–9]+', ' ', sw.strip()) for sw in stopwords]
		words_token = [w.strip() for w in tokens if w.strip() not in stopwords]

		##stemming
		token_list = []
		k = ''
		for i in words_token:
			lem = WordNetLemmatizer()
			lem_word = lem.lemmatize(i.strip(), pos="v")
			k += lem_word.strip() + ' '
			token_list.append(lem_word)
		processed_text = k.strip()
		match_check = 0
		if processed_text:
			pol_word_vader = sia.polarity_scores(k)['compound']
			# print("Vader polarity: " + str(pol_word_vader))
			pol_text_blob = TextBlob(processed_text).sentences[0].polarity
			# print("Textblob polarity: " + str(pol_text_blob))
			payload = "text=" + str(processed_text)
			try:
				response = requests.post('http://text-processing.com/api/sentiment/', data=payload, timeout=2)
				if response.status_code == 200:
					pol_senti_api = json.loads(response.text)['label']
				else:
					pol_senti_api = 'n/a'
			except Exception as e:
				print(e)
				pol_senti_api = str(e)
				pass
			if str(pol_senti_api) == "pos":
				pol_senti_api = "POSITIVE"
			if str(pol_senti_api) == "neg":
				pol_senti_api = "NEGATIVE"
			if str(pol_senti_api) == "neutral":
				pol_senti_api = "NEUTRAL"
			# print("Sentiment API polarity: " + pol_senti_api)
			# onfile.write(str(counter) + "\t" + str(review_text) + "\t" + str(processed_text) + "\t" + str(j) + "\t" + polarity(pol_text_blob) + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\n")
			for m in theme_stem:
				for n in theme_stem[m]:
					if n in token_list:
						match_check = 1
						# print(n, m)
						counter += 1
						onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
							+ "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
						    + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\t" + str(n) + "\t" + str(m) + "\tn/a\n")
						print("Processed: "+ str(counter) + "\n")
			if match_check == 0:
				counter += 1
				match_check = 1
				onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
                    + "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
				    + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\tn/a\tNo_match\tn/a\n")
				print("Processed: "+ str(counter) + "\n")
		else:
			counter += 1
			match_check = 1
			pol_word_vader = pol_text_blob = pol_senti_api = processed_text = 'n/a'
			onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
                + "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
			    + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\tn/a\tNo_match\tn/a\n")
			print("Processed: "+ str(counter) + "\n")


		for m in mentions_text:
			token = m['token']
			token = re.sub(r'[^A-Za-z0–9\'\`]+', ' ', token)
			token = re.sub(r'\t+|\r+|\s+|\n+', ' ', token.strip())
			token = re.sub(r'\s+', ' ', token.strip())
			if token in words:
				match_check = 1
				counter += 1
				onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
                    + "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
	                + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api)
					+ "\t" + str(token) + "\t" + str(m['theme']) + "\t" + str(m['subtheme']) + "\n")
				print("Processed: " + str(counter) + "\n")
		if match_check == 0:
			counter += 1
			onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
                + "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
                + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\tn/a\tNo match\tNo match\n")
			print("Processed: " + str(counter) + "\n")

	else:
		counter += 1
		review_text = processed_text = token_list = pol_senti_api = pol_word_vader = pol_text_blob = 'n/a'
		onfile.write(str(counter) + "\t" + str(product_id) + "\t" + str(review_id) + "\t" + str(review_text)
            + "\t" + str(processed_text) + "\t" + str(token_list) + "\t" + str(rating) + "\t" + polarity(pol_text_blob)
		    + "\t" + polarity(pol_word_vader) + "\t" + str(pol_senti_api) + "\tn/a\tNo match\tn/a\n")
		print("Processed: " + str(counter) + "\n")
